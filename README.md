# TD4-CPU

这是一台由 74 系列数字电路芯片组成的满足冯·诺依曼提出的计算机的五个基本构建块的计算机。

## 项目简介

这是一台由74系芯片搭建而成的四位计算机，它可以完成简单的输入输出，操作数传送，加法，（条件）转移运算，支持调节时钟频率、使用单次脉冲输入或使用外部时钟输入。除此以外，该计算机集成了输出数字用的数码管以及大量状态指示灯，可以直观的观察计算机的运行情况。通过使用贴片元器件，该工程的PCB板被压缩在了10*10cm以内，支持免费打样，并且所有元器件均在正面，元器件总体排布均匀，让手动贴片更加简单（若使用SMT，单面贴片可以大幅降低成本），同时提升了计算机的美观性。

本工程的设计方案来自于日本工程师度波郁（Iku Watanami）的著作《用10个IC轻松介绍CPU设计》，在原电路基础上进行了部分修改，并重新设计了PCB板。

## 项目功能

进行简单的输入输出、加法运算，实现操作数传送，进行（条件）转移。适合初学者简单了解计算机的基本组成和运行原理。

## 项目参数

2个运算寄存器（A、B）。

1个输出寄存器，1个程序计数器（PC）。

16B ROM(程序存储器)，使用拨码开关输入。

1个输入口，2个输出口，1个7段数码管（可显示0-15）。

1HZ&10HZ&可调节三组内部时钟（准确性不高，仅供参考）。

TYPE-C电源输入。

## 原理解析（硬件说明）

TD4-CPU由ROM阵列，寄存器组，算数与逻辑单元(ALU)，输入输出单元和时钟电路五部分组成，下面对它们逐一介绍。

ROM阵列的主体由16个拨码开关(U0-U15)组成，74HC154(U17)负责对PC寄存器发送的2进制数据进行译码，将对应的ROM单元后端下拉至低电平，ROM模块前端通过总线整体由8个电阻上拉至高电平。当ROM单元后端为低电平且拨码开关某一位导通时，这一位对应总线会被下拉至低电平，此时总线的电平状态就是该ROM单元存储的数据取反后的数值；之后总线上的数据经74HC540(U16)反相(增强驱动能力)后输出至ALU模块，完成读取PC寄存器指向的ROM单元数据的操作。

寄存器组由四个74HC161芯片构成，包含两个运算寄存器(REG_A (U19) & REG_B (U20))，一个输出寄存器，一个PC寄存器。运算寄存器负责存储即将参与运算的临时数据；输出寄存器负责对即将输出的数据进行锁存；PC寄存器(程序计数器)负责存储下一条要执行指令的首地址，CPU取址后PC寄存器会自动加一，此外PC寄存器内容也可以通过指令修改，从而实现程序的跳转运行。寄存器组数据由累加器(ADD)通过总线输入，四条LOAD控制线分别控制每个寄存器进行锁存操作，在系统复位后，四个寄存器均会被赋值为0x00。

ALU由多路复用器(MUX)、累加器(ADD)和逻辑单元组成

| 助记符 | 指令 | | 解释 | 
| --- | -------|----| --| --- |  
| MOV A,B | 0001 0000 | 将 B 寄存器传送到寄存器A。不受C标志影响，执行后C标志置0。 | 
| MOV B,A|0100 0000|将 A 寄存器转移到寄存器B。不受C标志影响，执行后C标志置0。| 
| MOV A,Im | 0011 XXXX | 将立即数XXXX传送到寄存器A。不受C标志影响，执行后C标志置0。 | 
| MOV B,Im | 0111 XXXX | 将立即数XXXX传送到寄存器B。不受C标志影响，执行后C标志置0。 | 
| ADD A,Im | 0000 XXXX | 将立即数XXXX累加到寄存器A。不受C标志影响，执行后发生进位C标志置1。 | 
| ADD B,Im | 0101 XXXX | 将立即数XXXX累加到寄存器B。不受C标志影响，执行后发生进位C标志置1。 | 
| IN A | 0010 0000 | 将输入端口数据传输到寄存器A。不受C标志影响，执行后C标志置0。 | 
| IN B | 0110 0000 | 将输入端口数据传输到寄存器B。不受C标志影响，执行后C标志置0。 | 
| OUT Im	 | 1011 XXXX | 将立即数XXXX传输到输出端口。不受C标志影响，执行后C标志置0。 | 
| OUT B | 1001 0000 | 将寄存器B传输到输出端口。不受C标志影响，执行后C标志置0。 | 
| JMP Im | 1111 XXXX | 程序跳转到立即数指示的地址XXXX。不受C标志影响，执行后C标志置0。 | 
| JC | 1110 XXXX | 当C标志为0时，程序跳转到立即数所指示的地址。反之什么都不做。执行后C标志置0。 | 

## 注意事项

在焊接插件前请进行通电测试，通过指示灯检查计算机运行情况，防止出现虚焊，芯片损坏等问题，以免影响后续实验。

焊接温度不应高于265℃，并且尽可能减少高温焊接时间，以免对元器件造成损坏。

## 参考图
原理图
![SCH_TD4-CPU v1 1_2025-04-041](https://github.com/user-attachments/assets/09751efc-cfa3-46d1-bc78-450b53b434a7)
![SCH_TD4-CPU v1 1_2025-04-072](https://github.com/user-attachments/assets/91bc5b03-d747-4e4a-94ae-0f0ae2f20b2d)
![SCH_TD4-CPU v1 1_2025-04-043](https://github.com/user-attachments/assets/1aab0533-a857-489e-bfd1-4be8fd4c6826)


仿真图
![3D_TD4_CPU v1 1_2025-04-05](https://github.com/user-attachments/assets/b20d53be-96db-415a-ad40-99f5a2076d9b)
![3D_TD4_CPU v1 1_2025-04-052](https://github.com/user-attachments/assets/452b4330-b5dc-4866-9420-5c32182f7f9b)


## 实物图
![微信图片_20250405150307](https://github.com/user-attachments/assets/f5feb81f-9cf6-4a11-9d9b-a06f05859e21)
![微信图片_20250405150259](https://github.com/user-attachments/assets/2d6ae476-23bb-4764-a443-037b0c1a4189)
![微信图片_20250405150250](https://github.com/user-attachments/assets/3f1130c7-2d60-4ddb-9260-767b0a3f5782)


## 版本更新
2024.11.4 项目立项。

2024.11.14 原理图绘制完成。

2024.11.16 PCB板绘制完成，第一次打样。

2025.1.18 焊接完成，时钟电路工作异常。

2025.1.20 修改时钟电路、数码管电路，第二次打样。

2025.2.1 第二次焊接完成，数码管线路绘制错误，对样板进行飞线处理后恢复正常。

2025.3.9 第三次打样，因此次打样仅在第二次基础上修改了两条线，基本肯定没有异常。

2025.3.15 收到样板，没有异常，项目暂时结项。
